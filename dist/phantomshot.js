/// <reference path="../all.d.ts" />
var PhantomShot;
(function (PhantomShot) {
    var Device = (function () {
        function Device(config) {
            this.devicePixelRatio = (config.devicePixelRatio ? config.devicePixelRatio : 1);
            this.height = config.height;
            this.width = config.width;
        }
        Device.prototype.getViewportSize = function () {
            return {
                height: this.height * this.devicePixelRatio,
                width: this.width * this.devicePixelRatio
            };
        };
        return Device;
    })();
    PhantomShot.Device = Device;
})(PhantomShot || (PhantomShot = {}));

/// <reference path="../all.d.ts" />

/// <reference path="../all.d.ts" />

/// <reference path="../all.d.ts" />

/// <reference path="../all.d.ts" />

/// <reference path="../all.d.ts" />

/// <reference path="../all.d.ts" />
var PhantomShot;
(function (_PhantomShot) {
    var PhantomShot = (function () {
        function PhantomShot(configFilePath) {
            var _this = this;
            this.filesystem = require("fs");
            this.system = require("system");
            this.webpage = require("webpage");
            this.defaultTimeout = 10 * 1000;
            this.configurationPath = configFilePath;
            this.page = this.webpage.create();
            // Set up loading state
            this.page.onLoadStarted = function () {
                _this.isLoading = true;
            };
            this.page.onLoadFinished = function (status) {
                _this.isLoading = false;
            };
        }
        PhantomShot.prototype.run = function (finishedCallback) {
            // Save finishedCallback
            this.finishedCallback = finishedCallback;
            // First do some preparation stuff
            this.readConfigFile(this.configurationPath);
            // Login
            if (this.configuration.login) {
                this.loginAndTakeScreenshots();
            }
            else {
                this.takeScreenshots();
            }
        };
        PhantomShot.prototype.buildFullUrl = function (path) {
            return this.configuration.baseUrl + "/" + path;
        };
        PhantomShot.prototype.loginAndTakeScreenshots = function () {
            var _this = this;
            this.page.open(this.buildFullUrl(this.configuration.login.url), function (result) {
                if (result == "success") {
                    console.log("Opened login page");
                    PhantomShot.evaluateJavaScript(_this.page, _this.configuration.login.inject);
                    // Now wait until page load has finished (user JS should trigger referral)
                    var timeout = window.setTimeout(function () {
                        console.error("Login timed out");
                        _this.finishedCallback(1);
                    }, _this.defaultTimeout);
                    var interval = window.setInterval(function () {
                        if (!_this.isLoading) {
                            window.clearTimeout(timeout);
                            window.clearInterval(interval);
                            _this.takeScreenshots();
                        }
                    });
                }
                else {
                    console.error("Login failed");
                    _this.finishedCallback(1);
                }
            });
        };
        PhantomShot.evaluateJavaScript = function (page, code) {
            var fs = require("fs");
            fs.write("tmpscript.js", code);
            page.injectJs("tmpscript.js");
            fs.remove("tmpscript.js");
        };
        PhantomShot.prototype.getDeviceById = function (id) {
            for (var i = 0; i < this.configuration.devices.length; i++) {
                if (this.configuration.devices[i].id == id) {
                    return new _PhantomShot.Device(this.configuration.devices[i]);
                }
            }
        };
        PhantomShot.prototype.getTargetFilename = function (config) {
            return this.configuration.outDir + "/" + config.id + ".png";
        };
        PhantomShot.prototype.takeScreenshot = function (config, callback) {
            var _this = this;
            var page = this.page;
            var timeout = window.setTimeout(function () {
                try {
                    page.close();
                    callback(false);
                }
                catch (ex) {
                }
            }, this.defaultTimeout);
            page.viewportSize = config.device.getViewportSize();
            page.open(config.url, function (result) {
                if (result == "success") {
                    try {
                        var rectangle = config.getTargetRectangle(page);
                        page.clipRect = rectangle;
                    }
                    catch (ex) {
                        console.error(ex);
                        callback(false);
                    }
                    // Inject javascript code
                    if (config.inject) {
                        try {
                            PhantomShot.evaluateJavaScript(page, config.inject);
                        }
                        catch (ex) {
                            console.error("Error executing JavaScript code");
                            console.error(ex);
                            callback(false);
                        }
                    }
                    window.setTimeout(function () {
                        // Render the page
                        page.render(_this.getTargetFilename(config));
                        // Clear timeout
                        window.clearTimeout(timeout);
                        // Finish shot
                        callback(true);
                    }, config.delay ? config.delay : 0);
                }
                else {
                    callback(false);
                }
            });
        };
        PhantomShot.prototype.takeScreenshots = function () {
            var _this = this;
            // Current shot counter since we're processing the queue asynchronously.
            var currentShot = 0;
            var processShot = function () {
                var config = _this.configuration.shots[currentShot];
                // Instantiate basic screenshot class
                var screenshot = new _PhantomShot.Screenshot();
                screenshot.id = config.id;
                screenshot.inject = config.inject;
                screenshot.url = _this.buildFullUrl(config.url);
                screenshot.device = _this.getDeviceById(config.device);
                screenshot.delay = config.delay;
                // Element or region mode
                if (config.element) {
                    screenshot.element = config.element;
                }
                else {
                    screenshot.region = new _PhantomShot.Rectangle(screenshot.device, config.region);
                }
                // Take the screenshot and loop to next one
                _this.takeScreenshot(screenshot, function (result) {
                    console.info((currentShot + 1) + ". " + (result ? "SUCCESS" : "ERROR") + ": " + screenshot.id + " (" + screenshot.url + ")");
                    if (currentShot == _this.configuration.shots.length - 1) {
                        _this.finishedCallback(0);
                    }
                    else {
                        currentShot++;
                        processShot();
                    }
                });
            };
            // Start processing
            processShot();
        };
        PhantomShot.prototype.readConfigFile = function (path) {
            // Read config
            console.info("Reading config from " + path);
            var data = this.filesystem.read(path);
            this.configuration = JSON.parse(data);
            if (this.configuration.timeout) {
                this.defaultTimeout = this.configuration.timeout * 1000;
            }
        };
        return PhantomShot;
    })();
    _PhantomShot.PhantomShot = PhantomShot;
})(PhantomShot || (PhantomShot = {}));

/// <reference path="../all.d.ts" />
var PhantomShot;
(function (PhantomShot) {
    var Rectangle = (function () {
        function Rectangle(device, config) {
            this.top = (config && config.top ? config.top : 0);
            this.left = (config && config.left ? config.left : 0);
            this.width = (config && config.width ? config.width : device.width);
            this.height = (config && config.height ? config.height : device.height);
        }
        return Rectangle;
    })();
    PhantomShot.Rectangle = Rectangle;
})(PhantomShot || (PhantomShot = {}));

/// <reference path="../all.d.ts" />
var PhantomShot;
(function (PhantomShot) {
    var Screenshot = (function () {
        function Screenshot() {
        }
        Screenshot.prototype.getTargetRectangle = function (page) {
            if (this.region) {
                return this.region;
            }
            else {
                // Inject target element selector via evaluateJavascript() since evaluate() is executed within
                // the page and cannot access variables in the current scope.
                PhantomShot.PhantomShot.evaluateJavaScript(page, "window.phantomShotTargetElement = " + JSON.stringify(this.element) + ";");
                // Get target rectangle
                var rectangle = page.evaluate(function () {
                    var element = document.querySelector(window.phantomShotTargetElement);
                    if (element == null) {
                        return null;
                    }
                    else {
                        var rectangle = element.getBoundingClientRect();
                        return {
                            top: rectangle.top,
                            left: rectangle.left,
                            width: rectangle.right - rectangle.left,
                            height: rectangle.bottom - rectangle.top
                        };
                    }
                });
                if (rectangle) {
                    return rectangle;
                }
                else {
                    throw "Target element (" + this.element + ") not found.";
                }
            }
        };
        return Screenshot;
    })();
    PhantomShot.Screenshot = Screenshot;
})(PhantomShot || (PhantomShot = {}));

/// <reference path="all.d.ts" />
var system = require("system");
var phantomShot = new PhantomShot.PhantomShot(system.args[1]);
phantomShot.run(function (result) {
    phantom.exit(result);
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi92YXIvd3d3L3BoYW50b21zaG90L1BoYW50b21TaG90L0RldmljZS50cyIsIi92YXIvd3d3L3BoYW50b21zaG90L1BoYW50b21TaG90L0lDb25maWd1cmF0aW9uLnRzIiwiL3Zhci93d3cvcGhhbnRvbXNob3QvUGhhbnRvbVNob3QvSURldmljZS50cyIsIi92YXIvd3d3L3BoYW50b21zaG90L1BoYW50b21TaG90L0lMb2dpbi50cyIsIi92YXIvd3d3L3BoYW50b21zaG90L1BoYW50b21TaG90L0lSZWdpb24udHMiLCIvdmFyL3d3dy9waGFudG9tc2hvdC9QaGFudG9tU2hvdC9JU2NyZWVuc2hvdC50cyIsIi92YXIvd3d3L3BoYW50b21zaG90L1BoYW50b21TaG90L1BoYW50b21TaG90LnRzIiwiL3Zhci93d3cvcGhhbnRvbXNob3QvUGhhbnRvbVNob3QvUmVjdGFuZ2xlLnRzIiwiL3Zhci93d3cvcGhhbnRvbXNob3QvUGhhbnRvbVNob3QvU2NyZWVuc2hvdC50cyIsIi92YXIvd3d3L3BoYW50b21zaG90L3BoYW50b21zaG90LnRzIl0sIm5hbWVzIjpbIlBoYW50b21TaG90IiwiUGhhbnRvbVNob3QuRGV2aWNlIiwiUGhhbnRvbVNob3QuRGV2aWNlLmNvbnN0cnVjdG9yIiwiUGhhbnRvbVNob3QuRGV2aWNlLmdldFZpZXdwb3J0U2l6ZSIsIlBoYW50b21TaG90LlBoYW50b21TaG90IiwiUGhhbnRvbVNob3QuUGhhbnRvbVNob3QuY29uc3RydWN0b3IiLCJQaGFudG9tU2hvdC5QaGFudG9tU2hvdC5ydW4iLCJQaGFudG9tU2hvdC5QaGFudG9tU2hvdC5idWlsZEZ1bGxVcmwiLCJQaGFudG9tU2hvdC5QaGFudG9tU2hvdC5sb2dpbkFuZFRha2VTY3JlZW5zaG90cyIsIlBoYW50b21TaG90LlBoYW50b21TaG90LmV2YWx1YXRlSmF2YVNjcmlwdCIsIlBoYW50b21TaG90LlBoYW50b21TaG90LmdldERldmljZUJ5SWQiLCJQaGFudG9tU2hvdC5QaGFudG9tU2hvdC5nZXRUYXJnZXRGaWxlbmFtZSIsIlBoYW50b21TaG90LlBoYW50b21TaG90LnRha2VTY3JlZW5zaG90IiwiUGhhbnRvbVNob3QuUGhhbnRvbVNob3QudGFrZVNjcmVlbnNob3RzIiwiUGhhbnRvbVNob3QuUGhhbnRvbVNob3QucmVhZENvbmZpZ0ZpbGUiLCJQaGFudG9tU2hvdC5SZWN0YW5nbGUiLCJQaGFudG9tU2hvdC5SZWN0YW5nbGUuY29uc3RydWN0b3IiLCJQaGFudG9tU2hvdC5TY3JlZW5zaG90IiwiUGhhbnRvbVNob3QuU2NyZWVuc2hvdC5jb25zdHJ1Y3RvciIsIlBoYW50b21TaG90LlNjcmVlbnNob3QuZ2V0VGFyZ2V0UmVjdGFuZ2xlIl0sIm1hcHBpbmdzIjoiQUFBQSxvQ0FBb0M7QUFFcEMsSUFBTyxXQUFXLENBbUJqQjtBQW5CRCxXQUFPLFdBQVcsRUFBQyxDQUFDO0lBQ2hCQSxJQUFhQSxNQUFNQTtRQUtmQyxTQUxTQSxNQUFNQSxDQUtIQSxNQUFlQTtZQUN2QkMsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxHQUFHQSxDQUFDQSxNQUFNQSxDQUFDQSxnQkFBZ0JBLEdBQUdBLE1BQU1BLENBQUNBLGdCQUFnQkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDaEZBLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO1lBQzVCQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQTtRQUM5QkEsQ0FBQ0E7UUFFREQsZ0NBQWVBLEdBQWZBO1lBQ0lFLE1BQU1BLENBQUNBO2dCQUNIQSxNQUFNQSxFQUFFQSxJQUFJQSxDQUFDQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxnQkFBZ0JBO2dCQUMzQ0EsS0FBS0EsRUFBRUEsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQTthQUM1Q0EsQ0FBQ0E7UUFDTkEsQ0FBQ0E7UUFDTEYsYUFBQ0E7SUFBREEsQ0FqQkFELEFBaUJDQyxJQUFBRDtJQWpCWUEs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LENBQUNBO2dCQUNyQkEsQ0FBQ0E7Z0JBQUNBLElBQUlBLENBQUNBLENBQUNBO29CQUNKQSxNQUFNQSxrQkFBa0JBLEdBQUdBLElBQUlBLENBQUNBLE9BQU9BLEdBQUdBLGNBQWNBLENBQUNBO2dCQUM3REEsQ0FBQ0E7WUFDTEEsQ0FBQ0E7UUFDTEEsQ0FBQ0E7UUFDTEYsaUJBQUNBO0lBQURBLENBeENBakIsQUF3Q0NpQixJQUFBakI7SUF4Q1lBLHNCQUFVQSxHQUFWQSxVQXdDWkEsQ0FBQUE7QUFDTEEsQ0FBQ0EsRUExQ00sV0FBVyxLQUFYLFdBQVcsUUEwQ2pCOztBQzVDRCxpQ0FBaUM7QUFFakMsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBRS9CLElBQUksV0FBVyxHQUFHLElBQUksV0FBVyxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDOUQsV0FBVyxDQUFDLEdBQUcsQ0FBQyxVQUFDLE1BQU07SUFBTyxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQUMsQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoicGhhbnRvbXNob3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vYWxsLmQudHNcIiAvPlxuXG5tb2R1bGUgUGhhbnRvbVNob3Qge1xuICAgIGV4cG9ydCBjbGFzcyBEZXZpY2Uge1xuICAgICAgICBkZXZpY2VQaXhlbFJhdGlvOiBudW1iZXI7XG4gICAgICAgIGhlaWdodDogbnVtYmVyO1xuICAgICAgICB3aWR0aDogbnVtYmVyO1xuXG4gICAgICAgIGNvbnN0cnVjdG9yKGNvbmZpZzogSURldmljZSkge1xuICAgICAgICAgICAgdGhpcy5kZXZpY2VQaXhlbFJhdGlvID0gKGNvbmZpZy5kZXZpY2VQaXhlbFJhdGlvID8gY29uZmlnLmRldmljZVBpeGVsUmF0aW8gOiAxKTtcbiAgICAgICAgICAgIHRoaXMuaGVpZ2h0ID0gY29uZmlnLmhlaWdodDtcbiAgICAgICAgICAgIHRoaXMud2lkdGggPSBjb25maWcud2lkdGg7XG4gICAgICAgIH1cblxuICAgICAgICBnZXRWaWV3cG9ydFNpemUoKTogU2l6ZSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGhlaWdodDogdGhpcy5oZWlnaHQgKiB0aGlzLmRldmljZVBpeGVsUmF0aW8sXG4gICAgICAgICAgICAgICAgd2lkdGg6IHRoaXMud2lkdGggKiB0aGlzLmRldmljZVBpeGVsUmF0aW9cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG59XG4iLCIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vYWxsLmQudHNcIiAvPlxuXG5tb2R1bGUgUGhhbnRvbVNob3Qge1xuICAgIGV4cG9ydCBpbnRlcmZhY2UgSUNvbmZpZ3VyYXRpb24ge1xuICAgICAgICBiYXNlVXJsOiBzdHJpbmc7XG4gICAgICAgIGZvcm1hdDogc3RyaW5nO1xuICAgICAgICBvdXREaXI6IHN0cmluZztcbiAgICAgICAgZGV2aWNlczogSURldmljZVtdO1xuICAgICAgICBzaG90czogSVNjcmVlbnNob3RbXTtcbiAgICAgICAgbG9naW46IElMb2dpbjtcbiAgICAgICAgdGltZW91dD86IG51bWJlcjtcbiAgICB9XG59XG4iLCIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vYWxsLmQudHNcIiAvPlxuXG5tb2R1bGUgUGhhbnRvbVNob3Qge1xuICAgIGV4cG9ydCBpbnRlcmZhY2UgSURldmljZVxuICAgIHtcbiAgICAgICAgaWQ6IHN0cmluZztcbiAgICAgICAgd2lkdGg/OiBudW1iZXI7XG4gICAgICAgIGhlaWdodD86IG51bWJlcjtcbiAgICAgICAgZGV2aWNlUGl4ZWxSYXRpbz86IG51bWJlcjtcbiAgICB9XG59XG4iLCIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vYWxsLmQudHNcIiAvPlxuXG5tb2R1bGUgUGhhbnRvbVNob3Qge1xuICAgIGV4cG9ydCBpbnRlcmZhY2UgSUxvZ2luIHtcbiAgICAgICAgdXJsOiBzdHJpbmc7XG4gICAgICAgIGluamVjdDogc3RyaW5nO1xuICAgIH1cbn1cbiIsIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi9hbGwuZC50c1wiIC8+XG5cbm1vZHVsZSBQaGFudG9tU2hvdCB7XG4gICAgZXhwb3J0IGludGVyZmFjZSBJUmVnaW9uIHtcbiAgICAgICAgdG9wPzogbnVtYmVyO1xuICAgICAgICBsZWZ0PzogbnVtYmVyO1xuICAgICAgICB3aWR0aD86IG51bWJlcjtcbiAgICAgICAgaGVpZ2h0PzogbnVtYmVyO1xuICAgIH1cbn1cbiIsIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi9hbGwuZC50c1wiIC8+XG5cbm1vZHVsZSBQaGFudG9tU2hvdCB7XG4gICAgZXhwb3J0IGludGVyZmFjZSBJU2NyZWVuc2hvdCB7XG4gICAgICAgIGlkOiBzdHJpbmc7XG4gICAgICAgIHVybDogc3RyaW5nO1xuICAgICAgICBkZWxheT86IG51bWJlcjtcbiAgICAgICAgZGV2aWNlOiBzdHJpbmc7XG4gICAgICAgIHJlZ2lvbj86IElSZWdpb247XG4gICAgICAgIGVsZW1lbnQ/OiBzdHJpbmc7XG4gICAgICAgIGluamVjdD86IHN0cmluZztcbiAgICB9XG59XG4iLCIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vYWxsLmQudHNcIiAvPlxuXG5tb2R1bGUgUGhhbnRvbVNob3Qge1xuICAgIGV4cG9ydCBjbGFzcyBQaGFudG9tU2hvdCB7XG5cbiAgICAgICAgcHJpdmF0ZSBmaWxlc3lzdGVtOiBGaWxlU3lzdGVtID0gcmVxdWlyZShcImZzXCIpO1xuICAgICAgICBwcml2YXRlIHN5c3RlbTogU3lzdGVtID0gcmVxdWlyZShcInN5c3RlbVwiKTtcbiAgICAgICAgcHJpdmF0ZSB3ZWJwYWdlID0gcmVxdWlyZShcIndlYnBhZ2VcIik7XG5cbiAgICAgICAgcHJpdmF0ZSBjb25maWd1cmF0aW9uUGF0aDogc3RyaW5nO1xuICAgICAgICBwcml2YXRlIGNvbmZpZ3VyYXRpb246IElDb25maWd1cmF0aW9uO1xuICAgICAgICBwcml2YXRlIHBhZ2U6IFdlYlBhZ2U7XG5cbiAgICAgICAgcHJpdmF0ZSBkZWZhdWx0VGltZW91dDogbnVtYmVyID0gMTAgKiAxMDAwO1xuXG4gICAgICAgIHByaXZhdGUgaXNMb2FkaW5nOiBib29sZWFuO1xuICAgICAgICBwcml2YXRlIGZpbmlzaGVkQ2FsbGJhY2s6IChyZXN1bHQ6IG51bWJlcikgPT4gdm9pZDtcblxuICAgICAgICBjb25zdHJ1Y3Rvcihjb25maWdGaWxlUGF0aDogc3RyaW5nKSB7XG4gICAgICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb25QYXRoID0gY29uZmlnRmlsZVBhdGg7XG4gICAgICAgICAgICB0aGlzLnBhZ2UgPSB0aGlzLndlYnBhZ2UuY3JlYXRlKCk7XG5cbiAgICAgICAgICAgIC8vIFNldCB1cCBsb2FkaW5nIHN0YXRlXG4gICAgICAgICAgICB0aGlzLnBhZ2Uub25Mb2FkU3RhcnRlZCA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5wYWdlLm9uTG9hZEZpbmlzaGVkID0gKHN0YXR1czogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICBydW4oZmluaXNoZWRDYWxsYmFjazogKHJlc3VsdDogbnVtYmVyKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgICAgICAgICAvLyBTYXZlIGZpbmlzaGVkQ2FsbGJhY2tcbiAgICAgICAgICAgIHRoaXMuZmluaXNoZWRDYWxsYmFjayA9IGZpbmlzaGVkQ2FsbGJhY2s7XG5cbiAgICAgICAgICAgIC8vIEZpcnN0IGRvIHNvbWUgcHJlcGFyYXRpb24gc3R1ZmZcbiAgICAgICAgICAgIHRoaXMucmVhZENvbmZpZ0ZpbGUodGhpcy5jb25maWd1cmF0aW9uUGF0aCk7XG5cbiAgICAgICAgICAgIC8vIExvZ2luXG4gICAgICAgICAgICBpZiAodGhpcy5jb25maWd1cmF0aW9uLmxvZ2luKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2dpbkFuZFRha2VTY3JlZW5zaG90cygpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRha2VTY3JlZW5zaG90cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcHJpdmF0ZSBidWlsZEZ1bGxVcmwocGF0aDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbmZpZ3VyYXRpb24uYmFzZVVybCArIFwiL1wiICsgcGF0aDtcbiAgICAgICAgfVxuXG4gICAgICAgIHByaXZhdGUgbG9naW5BbmRUYWtlU2NyZWVuc2hvdHMoKTogdm9pZCB7XG4gICAgICAgICAgICB0aGlzLnBhZ2Uub3BlbihcbiAgICAgICAgICAgICAgICB0aGlzLmJ1aWxkRnVsbFVybCh0aGlzLmNvbmZpZ3VyYXRpb24ubG9naW4udXJsKSxcbiAgICAgICAgICAgICAgICAocmVzdWx0OiBzdHJpbmcpID0+IHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0ID09IFwic3VjY2Vzc1wiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIk9wZW5lZCBsb2dpbiBwYWdlXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgUGhhbnRvbVNob3QuZXZhbHVhdGVKYXZhU2NyaXB0KHRoaXMucGFnZSwgdGhpcy5jb25maWd1cmF0aW9uLmxvZ2luLmluamVjdCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vdyB3YWl0IHVudGlsIHBhZ2UgbG9hZCBoYXMgZmluaXNoZWQgKHVzZXIgSlMgc2hvdWxkIHRyaWdnZXIgcmVmZXJyYWwpXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGltZW91dCA9IHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiTG9naW4gdGltZWQgb3V0XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmluaXNoZWRDYWxsYmFjaygxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMuZGVmYXVsdFRpbWVvdXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGludGVydmFsID0gd2luZG93LnNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNMb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKGludGVydmFsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50YWtlU2NyZWVuc2hvdHMoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJMb2dpbiBmYWlsZWRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbmlzaGVkQ2FsbGJhY2soMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBwdWJsaWMgc3RhdGljIGV2YWx1YXRlSmF2YVNjcmlwdChwYWdlOiBXZWJQYWdlLCBjb2RlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgICAgIHZhciBmcyA9IHJlcXVpcmUoXCJmc1wiKTtcbiAgICAgICAgICAgIGZzLndyaXRlKFwidG1wc2NyaXB0LmpzXCIsIGNvZGUpO1xuICAgICAgICAgICAgcGFnZS5pbmplY3RKcyhcInRtcHNjcmlwdC5qc1wiKTtcbiAgICAgICAgICAgIGZzLnJlbW92ZShcInRtcHNjcmlwdC5qc1wiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHByaXZhdGUgZ2V0RGV2aWNlQnlJZChpZDogc3RyaW5nKTogRGV2aWNlIHtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5jb25maWd1cmF0aW9uLmRldmljZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jb25maWd1cmF0aW9uLmRldmljZXNbaV0uaWQgPT0gaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEZXZpY2UodGhpcy5jb25maWd1cmF0aW9uLmRldmljZXNbaV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHByaXZhdGUgZ2V0VGFyZ2V0RmlsZW5hbWUoY29uZmlnOiBTY3JlZW5zaG90KTogc3RyaW5nIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbmZpZ3VyYXRpb24ub3V0RGlyICsgXCIvXCIgKyBjb25maWcuaWQgKyBcIi5wbmdcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIHByaXZhdGUgdGFrZVNjcmVlbnNob3QoY29uZmlnOiBTY3JlZW5zaG90LCBjYWxsYmFjazogKHJlc3VsdDogYm9vbGVhbikgPT4gdm9pZCk6IHZvaWQge1xuICAgICAgICAgICAgdmFyIHBhZ2UgPSB0aGlzLnBhZ2U7XG5cbiAgICAgICAgICAgIHZhciB0aW1lb3V0ID0gd2luZG93LnNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2UuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZmFsc2UpO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7fVxuICAgICAgICAgICAgfSwgdGhpcy5kZWZhdWx0VGltZW91dCk7XG5cbiAgICAgICAgICAgIHBhZ2Uudmlld3BvcnRTaXplID0gY29uZmlnLmRldmljZS5nZXRWaWV3cG9ydFNpemUoKTtcblxuICAgICAgICAgICAgcGFnZS5vcGVuKFxuICAgICAgICAgICAgICAgIGNvbmZpZy51cmwsXG4gICAgICAgICAgICAgICAgKHJlc3VsdDogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPT0gXCJzdWNjZXNzXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEdldCB0aGUgdGFyZ2V0IHJlY3RhbmdsZVxuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVjdGFuZ2xlID0gY29uZmlnLmdldFRhcmdldFJlY3RhbmdsZShwYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlLmNsaXBSZWN0ID0gcmVjdGFuZ2xlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGV4KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEluamVjdCBqYXZhc2NyaXB0IGNvZGVcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25maWcuaW5qZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGhhbnRvbVNob3QuZXZhbHVhdGVKYXZhU2NyaXB0KHBhZ2UsIGNvbmZpZy5pbmplY3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBleGVjdXRpbmcgSmF2YVNjcmlwdCBjb2RlXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGV4KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbmRlciB0aGUgcGFnZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2UucmVuZGVyKHRoaXMuZ2V0VGFyZ2V0RmlsZW5hbWUoY29uZmlnKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDbGVhciB0aW1lb3V0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNsZWFyVGltZW91dCh0aW1lb3V0KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZpbmlzaCBzaG90XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sodHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBjb25maWcuZGVsYXkgPyBjb25maWcuZGVsYXkgOiAwKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBwcml2YXRlIHRha2VTY3JlZW5zaG90cygpOiB2b2lkIHtcblxuICAgICAgICAgICAgLy8gQ3VycmVudCBzaG90IGNvdW50ZXIgc2luY2Ugd2UncmUgcHJvY2Vzc2luZyB0aGUgcXVldWUgYXN5bmNocm9ub3VzbHkuXG4gICAgICAgICAgICB2YXIgY3VycmVudFNob3QgPSAwO1xuXG4gICAgICAgICAgICB2YXIgcHJvY2Vzc1Nob3QgPSAoKSA9PiB7XG5cbiAgICAgICAgICAgICAgICB2YXIgY29uZmlnID0gdGhpcy5jb25maWd1cmF0aW9uLnNob3RzW2N1cnJlbnRTaG90XTtcblxuICAgICAgICAgICAgICAgIC8vIEluc3RhbnRpYXRlIGJhc2ljIHNjcmVlbnNob3QgY2xhc3NcbiAgICAgICAgICAgICAgICB2YXIgc2NyZWVuc2hvdCA9IG5ldyBTY3JlZW5zaG90KCk7XG4gICAgICAgICAgICAgICAgc2NyZWVuc2hvdC5pZCA9IGNvbmZpZy5pZDtcbiAgICAgICAgICAgICAgICBzY3JlZW5zaG90LmluamVjdCA9IGNvbmZpZy5pbmplY3Q7XG4gICAgICAgICAgICAgICAgc2NyZWVuc2hvdC51cmwgPSB0aGlzLmJ1aWxkRnVsbFVybChjb25maWcudXJsKTtcbiAgICAgICAgICAgICAgICBzY3JlZW5zaG90LmRldmljZSA9IHRoaXMuZ2V0RGV2aWNlQnlJZChjb25maWcuZGV2aWNlKTtcbiAgICAgICAgICAgICAgICBzY3JlZW5zaG90LmRlbGF5ID0gY29uZmlnLmRlbGF5O1xuXG4gICAgICAgICAgICAgICAgLy8gRWxlbWVudCBvciByZWdpb24gbW9kZVxuICAgICAgICAgICAgICAgIGlmIChjb25maWcuZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICBzY3JlZW5zaG90LmVsZW1lbnQgPSBjb25maWcuZWxlbWVudDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzY3JlZW5zaG90LnJlZ2lvbiA9IG5ldyBSZWN0YW5nbGUoc2NyZWVuc2hvdC5kZXZpY2UsIGNvbmZpZy5yZWdpb24pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIFRha2UgdGhlIHNjcmVlbnNob3QgYW5kIGxvb3AgdG8gbmV4dCBvbmVcbiAgICAgICAgICAgICAgICB0aGlzLnRha2VTY3JlZW5zaG90KFxuICAgICAgICAgICAgICAgICAgICBzY3JlZW5zaG90LFxuICAgICAgICAgICAgICAgICAgICAocmVzdWx0OiBib29sZWFuKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oKGN1cnJlbnRTaG90ICsgMSkgKyBcIi4gXCIgKyAocmVzdWx0ID8gXCJTVUNDRVNTXCIgOiBcIkVSUk9SXCIpICsgXCI6IFwiICsgc2NyZWVuc2hvdC5pZCArIFwiIChcIiArIHNjcmVlbnNob3QudXJsICsgXCIpXCIpXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50U2hvdCA9PSB0aGlzLmNvbmZpZ3VyYXRpb24uc2hvdHMubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmluaXNoZWRDYWxsYmFjaygwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFNob3QrKztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzU2hvdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIFN0YXJ0IHByb2Nlc3NpbmdcbiAgICAgICAgICAgIHByb2Nlc3NTaG90KCk7XG4gICAgICAgIH1cblxuICAgICAgICBwcml2YXRlIHJlYWRDb25maWdGaWxlKHBhdGg6IHN0cmluZykge1xuICAgICAgICAgICAgLy8gUmVhZCBjb25maWdcbiAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhcIlJlYWRpbmcgY29uZmlnIGZyb20gXCIgKyBwYXRoKTtcbiAgICAgICAgICAgIHZhciBkYXRhID0gdGhpcy5maWxlc3lzdGVtLnJlYWQocGF0aCk7XG4gICAgICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb24gPSBKU09OLnBhcnNlKGRhdGEpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5jb25maWd1cmF0aW9uLnRpbWVvdXQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRlZmF1bHRUaW1lb3V0ID0gdGhpcy5jb25maWd1cmF0aW9uLnRpbWVvdXQgKiAxMDAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuIiwiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uL2FsbC5kLnRzXCIgLz5cblxubW9kdWxlIFBoYW50b21TaG90IHtcbiAgICBleHBvcnQgY2xhc3MgUmVjdGFuZ2xlIGltcGxlbWVudHMgSVJlZ2lvbiwgQ2xpcFJlY3Qge1xuICAgICAgICB0b3A6IG51bWJlcjtcbiAgICAgICAgbGVmdDogbnVtYmVyO1xuICAgICAgICB3aWR0aDogbnVtYmVyO1xuICAgICAgICBoZWlnaHQ6IG51bWJlcjtcblxuICAgICAgICBjb25zdHJ1Y3RvcihkZXZpY2U6IERldmljZSwgY29uZmlnPzogSVJlZ2lvbikge1xuICAgICAgICAgICAgdGhpcy50b3AgPSAoY29uZmlnICYmIGNvbmZpZy50b3AgPyBjb25maWcudG9wIDogMCk7XG4gICAgICAgICAgICB0aGlzLmxlZnQgPSAoY29uZmlnICYmIGNvbmZpZy5sZWZ0ID8gY29uZmlnLmxlZnQgOiAwKTtcbiAgICAgICAgICAgIHRoaXMud2lkdGggPSAoY29uZmlnICYmIGNvbmZpZy53aWR0aCA/IGNvbmZpZy53aWR0aCA6IGRldmljZS53aWR0aCk7XG4gICAgICAgICAgICB0aGlzLmhlaWdodCA9IChjb25maWcgJiYgY29uZmlnLmhlaWdodCA/IGNvbmZpZy5oZWlnaHQgOiBkZXZpY2UuaGVpZ2h0KTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiIsIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi9hbGwuZC50c1wiIC8+XG5cbm1vZHVsZSBQaGFudG9tU2hvdCB7XG4gICAgZXhwb3J0IGNsYXNzIFNjcmVlbnNob3Qge1xuICAgICAgICBpZDogc3RyaW5nO1xuICAgICAgICBkZWxheTogbnVtYmVyO1xuICAgICAgICBkZXZpY2U6IERldmljZTtcbiAgICAgICAgdXJsOiBzdHJpbmc7XG4gICAgICAgIGluamVjdDogc3RyaW5nO1xuICAgICAgICByZWdpb246IFJlY3RhbmdsZTtcbiAgICAgICAgZWxlbWVudDogc3RyaW5nO1xuXG4gICAgICAgIGdldFRhcmdldFJlY3RhbmdsZShwYWdlOiBXZWJQYWdlKTogUmVjdGFuZ2xlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnJlZ2lvbikge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlZ2lvbjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gSW5qZWN0IHRhcmdldCBlbGVtZW50IHNlbGVjdG9yIHZpYSBldmFsdWF0ZUphdmFzY3JpcHQoKSBzaW5jZSBldmFsdWF0ZSgpIGlzIGV4ZWN1dGVkIHdpdGhpblxuICAgICAgICAgICAgICAgIC8vIHRoZSBwYWdlIGFuZCBjYW5ub3QgYWNjZXNzIHZhcmlhYmxlcyBpbiB0aGUgY3VycmVudCBzY29wZS5cbiAgICAgICAgICAgICAgICBQaGFudG9tU2hvdC5ldmFsdWF0ZUphdmFTY3JpcHQocGFnZSwgXCJ3aW5kb3cucGhhbnRvbVNob3RUYXJnZXRFbGVtZW50ID0gXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmVsZW1lbnQpICsgXCI7XCIpO1xuXG4gICAgICAgICAgICAgICAgLy8gR2V0IHRhcmdldCByZWN0YW5nbGVcbiAgICAgICAgICAgICAgICB2YXIgcmVjdGFuZ2xlID0gcGFnZS5ldmFsdWF0ZShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCg8YW55PndpbmRvdykucGhhbnRvbVNob3RUYXJnZXRFbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVjdGFuZ2xlID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiByZWN0YW5nbGUudG9wLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IHJlY3RhbmdsZS5sZWZ0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiByZWN0YW5nbGUucmlnaHQgLSByZWN0YW5nbGUubGVmdCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IHJlY3RhbmdsZS5ib3R0b20gLSByZWN0YW5nbGUudG9wXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpZiAocmVjdGFuZ2xlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZWN0YW5nbGU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgXCJUYXJnZXQgZWxlbWVudCAoXCIgKyB0aGlzLmVsZW1lbnQgKyBcIikgbm90IGZvdW5kLlwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn0iLCIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiYWxsLmQudHNcIiAvPlxuXG52YXIgc3lzdGVtID0gcmVxdWlyZShcInN5c3RlbVwiKTtcblxudmFyIHBoYW50b21TaG90ID0gbmV3IFBoYW50b21TaG90LlBoYW50b21TaG90KHN5c3RlbS5hcmdzWzFdKTtcbnBoYW50b21TaG90LnJ1bigocmVzdWx0KSA9PiB7IHBoYW50b20uZXhpdChyZXN1bHQpOyB9KTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
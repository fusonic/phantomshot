/// <reference path="../all.d.ts" />
var PhantomShot;
(function (PhantomShot) {
    var Device = (function () {
        function Device(config) {
            this.devicePixelRatio = (config.devicePixelRatio ? config.devicePixelRatio : 1);
            this.height = config.height;
            this.width = config.width;
        }
        Device.prototype.getViewportSize = function () {
            return {
                height: this.height * this.devicePixelRatio,
                width: this.width * this.devicePixelRatio
            };
        };
        return Device;
    })();
    PhantomShot.Device = Device;
})(PhantomShot || (PhantomShot = {}));

/// <reference path="../all.d.ts" />

/// <reference path="../all.d.ts" />

/// <reference path="../all.d.ts" />

/// <reference path="../all.d.ts" />

/// <reference path="../all.d.ts" />

/// <reference path="../all.d.ts" />
var PhantomShot;
(function (_PhantomShot) {
    var PhantomShot = (function () {
        function PhantomShot(configFilePath) {
            var _this = this;
            this.filesystem = require("fs");
            this.system = require("system");
            this.webpage = require("webpage");
            this.defaultTimeout = 10 * 1000;
            this.configurationPath = configFilePath;
            this.page = this.webpage.create();
            // Set up loading state
            this.page.onLoadStarted = function () {
                _this.isLoading = true;
            };
            this.page.onLoadFinished = function (status) {
                _this.isLoading = false;
            };
        }
        PhantomShot.prototype.run = function (finishedCallback) {
            // Save finishedCallback
            this.finishedCallback = finishedCallback;
            // First do some preparation stuff
            this.readConfigFile(this.configurationPath);
            // Login
            if (this.configuration.login) {
                this.loginAndTakeScreenshots();
            }
            else {
                this.takeScreenshots();
            }
        };
        PhantomShot.prototype.buildFullUrl = function (path) {
            return this.configuration.baseUrl + path;
        };
        PhantomShot.prototype.loginAndTakeScreenshots = function () {
            var _this = this;
            this.page.open(this.buildFullUrl(this.configuration.login.url), function (result) {
                if (result == "success") {
                    console.log("Opened login page");
                    PhantomShot.evaluateJavaScript(_this.page, _this.configuration.login.inject);
                    // Now wait until page load has finished (user JS should trigger referral)
                    var timeout = window.setTimeout(function () {
                        console.error("Login timed out");
                        _this.finishedCallback(1);
                    }, _this.defaultTimeout);
                    var interval = window.setInterval(function () {
                        if (!_this.isLoading) {
                            window.clearTimeout(timeout);
                            window.clearInterval(interval);
                            _this.takeScreenshots();
                        }
                    });
                }
                else {
                    console.error("Login failed");
                    _this.finishedCallback(1);
                }
            });
        };
        PhantomShot.evaluateJavaScript = function (page, code) {
            var tmpScriptName = "phantomjs" + Math.round(Math.random() * 1000) + ".js";
            var fs = require("fs");
            fs.write(tmpScriptName, code);
            page.injectJs(tmpScriptName);
            fs.remove(tmpScriptName);
        };
        PhantomShot.prototype.getDeviceById = function (id) {
            for (var i = 0; i < this.configuration.devices.length; i++) {
                if (this.configuration.devices[i].id == id) {
                    return new _PhantomShot.Device(this.configuration.devices[i]);
                }
            }
        };
        PhantomShot.prototype.getTargetFilename = function (config) {
            return this.configuration.outDir + "/" + config.id + ".png";
        };
        PhantomShot.prototype.takeScreenshot = function (config, callback) {
            var _this = this;
            var page = this.page;
            var timeout = window.setTimeout(function () {
                try {
                    page.close();
                    callback(false);
                }
                catch (ex) {
                }
            }, this.defaultTimeout);
            page.viewportSize = config.device.getViewportSize();
            page.open(config.url, function (result) {
                if (result == "success") {
                    try {
                        var rectangle = config.getTargetRectangle(page);
                        page.clipRect = rectangle;
                    }
                    catch (ex) {
                        console.error(ex);
                        callback(false);
                    }
                    // Inject javascript code
                    if (config.inject) {
                        try {
                            PhantomShot.evaluateJavaScript(page, config.inject);
                        }
                        catch (ex) {
                            console.error("Error executing JavaScript code");
                            console.error(ex);
                            callback(false);
                        }
                    }
                    window.setTimeout(function () {
                        // Render the page
                        page.render(_this.getTargetFilename(config));
                        // Clear timeout
                        window.clearTimeout(timeout);
                        // Finish shot
                        callback(true);
                    }, config.delay ? config.delay : 0);
                }
                else {
                    callback(false);
                }
            });
        };
        PhantomShot.prototype.takeScreenshots = function () {
            var _this = this;
            // Current shot counter since we're processing the queue asynchronously.
            var currentShot = 0;
            var processShot = function () {
                var config = _this.configuration.shots[currentShot];
                // Instantiate basic screenshot class
                var screenshot = new _PhantomShot.Screenshot();
                screenshot.id = config.id;
                screenshot.inject = config.inject;
                screenshot.url = _this.buildFullUrl(config.url);
                screenshot.device = _this.getDeviceById(config.device);
                screenshot.delay = config.delay;
                // Element or region mode
                if (config.element) {
                    screenshot.element = config.element;
                }
                else {
                    screenshot.region = new _PhantomShot.Rectangle(screenshot.device, config.region);
                }
                // Take the screenshot and loop to next one
                _this.takeScreenshot(screenshot, function (result) {
                    console.info((currentShot + 1) + ". " + (result ? "SUCCESS" : "ERROR") + ": " + screenshot.id + " (" + screenshot.url + ")");
                    if (currentShot == _this.configuration.shots.length - 1) {
                        _this.finishedCallback(0);
                    }
                    else {
                        currentShot++;
                        processShot();
                    }
                });
            };
            // Start processing
            processShot();
        };
        PhantomShot.prototype.readConfigFile = function (path) {
            // Read config
            console.info("Reading config from " + path);
            var data = this.filesystem.read(path);
            this.configuration = JSON.parse(data);
            if (this.configuration.timeout) {
                this.defaultTimeout = this.configuration.timeout * 1000;
            }
        };
        return PhantomShot;
    })();
    _PhantomShot.PhantomShot = PhantomShot;
})(PhantomShot || (PhantomShot = {}));

/// <reference path="../all.d.ts" />
var PhantomShot;
(function (PhantomShot) {
    var Rectangle = (function () {
        function Rectangle(device, config) {
            this.top = (config && config.top ? config.top : 0);
            this.left = (config && config.left ? config.left : 0);
            this.width = (config && config.width ? config.width : device.width);
            this.height = (config && config.height ? config.height : device.height);
        }
        return Rectangle;
    })();
    PhantomShot.Rectangle = Rectangle;
})(PhantomShot || (PhantomShot = {}));

/// <reference path="../all.d.ts" />
var PhantomShot;
(function (PhantomShot) {
    var Screenshot = (function () {
        function Screenshot() {
        }
        Screenshot.prototype.getTargetRectangle = function (page) {
            if (this.region) {
                return this.region;
            }
            else {
                // Inject target element selector via evaluateJavascript() since evaluate() is executed within
                // the page and cannot access variables in the current scope.
                PhantomShot.PhantomShot.evaluateJavaScript(page, "window.phantomShotTargetElement = " + JSON.stringify(this.element) + ";");
                // Get target rectangle
                var rectangle = page.evaluate(function () {
                    var element = document.querySelector(window.phantomShotTargetElement);
                    if (element == null) {
                        return null;
                    }
                    else {
                        var rectangle = element.getBoundingClientRect();
                        return {
                            top: rectangle.top,
                            left: rectangle.left,
                            width: rectangle.right - rectangle.left,
                            height: rectangle.bottom - rectangle.top
                        };
                    }
                });
                if (rectangle) {
                    return rectangle;
                }
                else {
                    throw "Target element (" + this.element + ") not found.";
                }
            }
        };
        return Screenshot;
    })();
    PhantomShot.Screenshot = Screenshot;
})(PhantomShot || (PhantomShot = {}));

/// <reference path="all.d.ts" />
var system = require("system");
var phantomShot = new PhantomShot.PhantomShot(system.args[1]);
phantomShot.run(function (result) {
    phantom.exit(result);
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi92YXIvd3d3L3BoYW50b21zaG90L1BoYW50b21TaG90L0RldmljZS50cyIsIi92YXIvd3d3L3BoYW50b21zaG90L1BoYW50b21TaG90L0lDb25maWd1cmF0aW9uLnRzIiwiL3Zhci93d3cvcGhhbnRvbXNob3QvUGhhbnRvbVNob3QvSURldmljZS50cyIsIi92YXIvd3d3L3BoYW50b21zaG90L1BoYW50b21TaG90L0lMb2dpbi50cyIsIi92YXIvd3d3L3BoYW50b21zaG90L1BoYW50b21TaG90L0lSZWdpb24udHMiLCIvdmFyL3d3dy9waGFudG9tc2hvdC9QaGFudG9tU2hvdC9JU2NyZWVuc2hvdC50cyIsIi92YXIvd3d3L3BoYW50b21zaG90L1BoYW50b21TaG90L1BoYW50b21TaG90LnRzIiwiL3Zhci93d3cvcGhhbnRvbXNob3QvUGhhbnRvbVNob3QvUmVjdGFuZ2xlLnRzIiwiL3Zhci93d3cvcGhhbnRvbXNob3QvUGhhbnRvbVNob3QvU2NyZWVuc2hvdC50cyIsIi92YXIvd3d3L3BoYW50b21zaG90L3BoYW50b21zaG90LnRzIl0sIm5hbWVzIjpbIlBoYW50b21TaG90IiwiUGhhbnRvbVNob3QuRGV2aWNlIiwiUGhhbnRvbVNob3QuRGV2aWNlLmNvbnN0cnVjdG9yIiwiUGhhbnRvbVNob3QuRGV2aWNlLmdldFZpZXdwb3J0U2l6ZSIsIlBoYW50b21TaG90LlBoYW50b21TaG90IiwiUGhhbnRvbVNob3QuUGhhbnRvbVNob3QuY29uc3RydWN0b3IiLCJQaGFudG9tU2hvdC5QaGFudG9tU2hvdC5ydW4iLCJQaGFudG9tU2hvdC5QaGFudG9tU2hvdC5idWlsZEZ1bGxVcmwiLCJQaGFudG9tU2hvdC5QaGFudG9tU2hvdC5sb2dpbkFuZFRha2VTY3JlZW5zaG90cyIsIlBoYW50b21TaG90LlBoYW50b21TaG90LmV2YWx1YXRlSmF2YVNjcmlwdCIsIlBoYW50b21TaG90LlBoYW50b21TaG90LmdldERldmljZUJ5SWQiLCJQaGFudG9tU2hvdC5QaGFudG9tU2hvdC5nZXRUYXJnZXRGaWxlbmFtZSIsIlBoYW50b21TaG90LlBoYW50b21TaG90LnRha2VTY3JlZW5zaG90IiwiUGhhbnRvbVNob3QuUGhhbnRvbVNob3QudGFrZVNjcmVlbnNob3RzIiwiUGhhbnRvbVNob3QuUGhhbnRvbVNob3QucmVhZENvbmZpZ0ZpbGUiLCJQaGFudG9tU2hvdC5SZWN0YW5nbGUiLCJQaGFudG9tU2hvdC5SZWN0YW5nbGUuY29uc3RydWN0b3IiLCJQaGFudG9tU2hvdC5TY3JlZW5zaG90IiwiUGhhbnRvbVNob3QuU2NyZWVuc2hvdC5jb25zdHJ1Y3RvciIsIlBoYW50b21TaG90LlNjcmVlbnNob3QuZ2V0VGFyZ2V0UmVjdGFuZ2xlIl0sIm1hcHBpbmdzIjoiQUFBQSxvQ0FBb0M7QUFFcEMsSUFBTyxXQUFXLENBbUJqQjtBQW5CRCxXQUFPLFdBQVcsRUFBQyxDQUFDO0lBQ2hCQSxJQUFhQSxNQUFNQTtRQUtmQyxTQUxTQSxNQUFNQSxDQUtIQSxNQUFlQTtZQUN2QkMsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxHQUFHQSxDQUFDQSxNQUFNQSxDQUFDQSxnQkFBZ0JBLEdBQUdBLE1BQU1BLENBQUNBLGdCQUFnQkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDaEZBLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO1lBQzVCQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQTtRQUM5QkEsQ0FBQ0E7UUFFREQsZ0NBQWVBLEdBQWZBO1lBQ0lFLE1BQU1BLENBQUNBO2dCQUNIQSxNQUFNQSxFQUFFQSxJQUFJQSxDQUFDQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxnQkFBZ0JBO2dCQUMzQ0EsS0FBS0EsRUFBRUEsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQTthQUM1Q0EsQ0FBQ0E7UUFDTkEsQ0FBQ0E7UUFDTEYsYUFBQ0E7SUFBREEsQ0FqQkFELEFBaUJDQyxJQUFBRDtJQWpCWUEs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QztvQkFDTixDQUFDO2dCQUNMLENBQUMsQ0FBQ0EsQ0FBQ0E7Z0JBRUhBLEVBQUVBLENBQUNBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBO29CQUNaQSxNQUFNQSxDQUFDQSxTQUFTQSxDQUFDQTtnQkFDckJBLENBQUNBO2dCQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtvQkFDSkEsTUFBTUEsa0JBQWtCQSxHQUFHQSxJQUFJQSxDQUFDQSxPQUFPQSxHQUFHQSxjQUFjQSxDQUFDQTtnQkFDN0RBLENBQUNBO1lBQ0xBLENBQUNBO1FBQ0xBLENBQUNBO1FBQ0xGLGlCQUFDQTtJQUFEQSxDQXhDQWpCLEFBd0NDaUIsSUFBQWpCO0lBeENZQSxzQkFBVUEsR0FBVkEsVUF3Q1pBLENBQUFBO0FBQ0xBLENBQUNBLEVBMUNNLFdBQVcsS0FBWCxXQUFXLFFBMENqQjs7QUM1Q0QsaUNBQWlDO0FBRWpDLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUUvQixJQUFJLFdBQVcsR0FBRyxJQUFJLFdBQVcsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQzlELFdBQVcsQ0FBQyxHQUFHLENBQUMsVUFBQyxNQUFNO0lBQU8sT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUFDLENBQUMsQ0FBQyxDQUFDIiwiZmlsZSI6InBoYW50b21zaG90LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uL2FsbC5kLnRzXCIgLz5cblxubW9kdWxlIFBoYW50b21TaG90IHtcbiAgICBleHBvcnQgY2xhc3MgRGV2aWNlIHtcbiAgICAgICAgZGV2aWNlUGl4ZWxSYXRpbzogbnVtYmVyO1xuICAgICAgICBoZWlnaHQ6IG51bWJlcjtcbiAgICAgICAgd2lkdGg6IG51bWJlcjtcblxuICAgICAgICBjb25zdHJ1Y3Rvcihjb25maWc6IElEZXZpY2UpIHtcbiAgICAgICAgICAgIHRoaXMuZGV2aWNlUGl4ZWxSYXRpbyA9IChjb25maWcuZGV2aWNlUGl4ZWxSYXRpbyA/IGNvbmZpZy5kZXZpY2VQaXhlbFJhdGlvIDogMSk7XG4gICAgICAgICAgICB0aGlzLmhlaWdodCA9IGNvbmZpZy5oZWlnaHQ7XG4gICAgICAgICAgICB0aGlzLndpZHRoID0gY29uZmlnLndpZHRoO1xuICAgICAgICB9XG5cbiAgICAgICAgZ2V0Vmlld3BvcnRTaXplKCk6IFNpemUge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IHRoaXMuaGVpZ2h0ICogdGhpcy5kZXZpY2VQaXhlbFJhdGlvLFxuICAgICAgICAgICAgICAgIHdpZHRoOiB0aGlzLndpZHRoICogdGhpcy5kZXZpY2VQaXhlbFJhdGlvXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfVxufVxuIiwiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uL2FsbC5kLnRzXCIgLz5cblxubW9kdWxlIFBoYW50b21TaG90IHtcbiAgICBleHBvcnQgaW50ZXJmYWNlIElDb25maWd1cmF0aW9uIHtcbiAgICAgICAgYmFzZVVybDogc3RyaW5nO1xuICAgICAgICBmb3JtYXQ6IHN0cmluZztcbiAgICAgICAgb3V0RGlyOiBzdHJpbmc7XG4gICAgICAgIGRldmljZXM6IElEZXZpY2VbXTtcbiAgICAgICAgc2hvdHM6IElTY3JlZW5zaG90W107XG4gICAgICAgIGxvZ2luOiBJTG9naW47XG4gICAgICAgIHRpbWVvdXQ/OiBudW1iZXI7XG4gICAgfVxufVxuIiwiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uL2FsbC5kLnRzXCIgLz5cblxubW9kdWxlIFBoYW50b21TaG90IHtcbiAgICBleHBvcnQgaW50ZXJmYWNlIElEZXZpY2VcbiAgICB7XG4gICAgICAgIGlkOiBzdHJpbmc7XG4gICAgICAgIHdpZHRoPzogbnVtYmVyO1xuICAgICAgICBoZWlnaHQ/OiBudW1iZXI7XG4gICAgICAgIGRldmljZVBpeGVsUmF0aW8/OiBudW1iZXI7XG4gICAgfVxufVxuIiwiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uL2FsbC5kLnRzXCIgLz5cblxubW9kdWxlIFBoYW50b21TaG90IHtcbiAgICBleHBvcnQgaW50ZXJmYWNlIElMb2dpbiB7XG4gICAgICAgIHVybDogc3RyaW5nO1xuICAgICAgICBpbmplY3Q6IHN0cmluZztcbiAgICB9XG59XG4iLCIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vYWxsLmQudHNcIiAvPlxuXG5tb2R1bGUgUGhhbnRvbVNob3Qge1xuICAgIGV4cG9ydCBpbnRlcmZhY2UgSVJlZ2lvbiB7XG4gICAgICAgIHRvcD86IG51bWJlcjtcbiAgICAgICAgbGVmdD86IG51bWJlcjtcbiAgICAgICAgd2lkdGg/OiBudW1iZXI7XG4gICAgICAgIGhlaWdodD86IG51bWJlcjtcbiAgICB9XG59XG4iLCIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vYWxsLmQudHNcIiAvPlxuXG5tb2R1bGUgUGhhbnRvbVNob3Qge1xuICAgIGV4cG9ydCBpbnRlcmZhY2UgSVNjcmVlbnNob3Qge1xuICAgICAgICBpZDogc3RyaW5nO1xuICAgICAgICB1cmw6IHN0cmluZztcbiAgICAgICAgZGVsYXk/OiBudW1iZXI7XG4gICAgICAgIGRldmljZTogc3RyaW5nO1xuICAgICAgICByZWdpb24/OiBJUmVnaW9uO1xuICAgICAgICBlbGVtZW50Pzogc3RyaW5nO1xuICAgICAgICBpbmplY3Q/OiBzdHJpbmc7XG4gICAgfVxufVxuIiwiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uL2FsbC5kLnRzXCIgLz5cblxubW9kdWxlIFBoYW50b21TaG90IHtcbiAgICBleHBvcnQgY2xhc3MgUGhhbnRvbVNob3Qge1xuXG4gICAgICAgIHByaXZhdGUgZmlsZXN5c3RlbTogRmlsZVN5c3RlbSA9IHJlcXVpcmUoXCJmc1wiKTtcbiAgICAgICAgcHJpdmF0ZSBzeXN0ZW06IFN5c3RlbSA9IHJlcXVpcmUoXCJzeXN0ZW1cIik7XG4gICAgICAgIHByaXZhdGUgd2VicGFnZSA9IHJlcXVpcmUoXCJ3ZWJwYWdlXCIpO1xuXG4gICAgICAgIHByaXZhdGUgY29uZmlndXJhdGlvblBhdGg6IHN0cmluZztcbiAgICAgICAgcHJpdmF0ZSBjb25maWd1cmF0aW9uOiBJQ29uZmlndXJhdGlvbjtcbiAgICAgICAgcHJpdmF0ZSBwYWdlOiBXZWJQYWdlO1xuXG4gICAgICAgIHByaXZhdGUgZGVmYXVsdFRpbWVvdXQ6IG51bWJlciA9IDEwICogMTAwMDtcblxuICAgICAgICBwcml2YXRlIGlzTG9hZGluZzogYm9vbGVhbjtcbiAgICAgICAgcHJpdmF0ZSBmaW5pc2hlZENhbGxiYWNrOiAocmVzdWx0OiBudW1iZXIpID0+IHZvaWQ7XG5cbiAgICAgICAgY29uc3RydWN0b3IoY29uZmlnRmlsZVBhdGg6IHN0cmluZykge1xuICAgICAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uUGF0aCA9IGNvbmZpZ0ZpbGVQYXRoO1xuICAgICAgICAgICAgdGhpcy5wYWdlID0gdGhpcy53ZWJwYWdlLmNyZWF0ZSgpO1xuXG4gICAgICAgICAgICAvLyBTZXQgdXAgbG9hZGluZyBzdGF0ZVxuICAgICAgICAgICAgdGhpcy5wYWdlLm9uTG9hZFN0YXJ0ZWQgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMucGFnZS5vbkxvYWRGaW5pc2hlZCA9IChzdGF0dXM6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcnVuKGZpbmlzaGVkQ2FsbGJhY2s6IChyZXN1bHQ6IG51bWJlcikgPT4gdm9pZCk6IHZvaWQge1xuICAgICAgICAgICAgLy8gU2F2ZSBmaW5pc2hlZENhbGxiYWNrXG4gICAgICAgICAgICB0aGlzLmZpbmlzaGVkQ2FsbGJhY2sgPSBmaW5pc2hlZENhbGxiYWNrO1xuXG4gICAgICAgICAgICAvLyBGaXJzdCBkbyBzb21lIHByZXBhcmF0aW9uIHN0dWZmXG4gICAgICAgICAgICB0aGlzLnJlYWRDb25maWdGaWxlKHRoaXMuY29uZmlndXJhdGlvblBhdGgpO1xuXG4gICAgICAgICAgICAvLyBMb2dpblxuICAgICAgICAgICAgaWYgKHRoaXMuY29uZmlndXJhdGlvbi5sb2dpbikge1xuICAgICAgICAgICAgICAgIHRoaXMubG9naW5BbmRUYWtlU2NyZWVuc2hvdHMoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy50YWtlU2NyZWVuc2hvdHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHByaXZhdGUgYnVpbGRGdWxsVXJsKHBhdGg6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb25maWd1cmF0aW9uLmJhc2VVcmwgKyBwYXRoO1xuICAgICAgICB9XG5cbiAgICAgICAgcHJpdmF0ZSBsb2dpbkFuZFRha2VTY3JlZW5zaG90cygpOiB2b2lkIHtcbiAgICAgICAgICAgIHRoaXMucGFnZS5vcGVuKFxuICAgICAgICAgICAgICAgIHRoaXMuYnVpbGRGdWxsVXJsKHRoaXMuY29uZmlndXJhdGlvbi5sb2dpbi51cmwpLFxuICAgICAgICAgICAgICAgIChyZXN1bHQ6IHN0cmluZykgPT4ge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPT0gXCJzdWNjZXNzXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiT3BlbmVkIGxvZ2luIHBhZ2VcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBQaGFudG9tU2hvdC5ldmFsdWF0ZUphdmFTY3JpcHQodGhpcy5wYWdlLCB0aGlzLmNvbmZpZ3VyYXRpb24ubG9naW4uaW5qZWN0KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gTm93IHdhaXQgdW50aWwgcGFnZSBsb2FkIGhhcyBmaW5pc2hlZCAodXNlciBKUyBzaG91bGQgdHJpZ2dlciByZWZlcnJhbClcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0aW1lb3V0ID0gd2luZG93LnNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJMb2dpbiB0aW1lZCBvdXRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maW5pc2hlZENhbGxiYWNrKDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcy5kZWZhdWx0VGltZW91dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW50ZXJ2YWwgPSB3aW5kb3cuc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc0xvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRha2VTY3JlZW5zaG90cygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkxvZ2luIGZhaWxlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmluaXNoZWRDYWxsYmFjaygxKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgZXZhbHVhdGVKYXZhU2NyaXB0KHBhZ2U6IFdlYlBhZ2UsIGNvZGU6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICAgICAgdmFyIHRtcFNjcmlwdE5hbWUgPSBcInBoYW50b21qc1wiICsgTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpICogMTAwMCkgKyBcIi5qc1wiO1xuICAgICAgICAgICAgdmFyIGZzID0gcmVxdWlyZShcImZzXCIpO1xuICAgICAgICAgICAgZnMud3JpdGUodG1wU2NyaXB0TmFtZSwgY29kZSk7XG4gICAgICAgICAgICBwYWdlLmluamVjdEpzKHRtcFNjcmlwdE5hbWUpO1xuICAgICAgICAgICAgZnMucmVtb3ZlKHRtcFNjcmlwdE5hbWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgcHJpdmF0ZSBnZXREZXZpY2VCeUlkKGlkOiBzdHJpbmcpOiBEZXZpY2Uge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmNvbmZpZ3VyYXRpb24uZGV2aWNlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbmZpZ3VyYXRpb24uZGV2aWNlc1tpXS5pZCA9PSBpZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERldmljZSh0aGlzLmNvbmZpZ3VyYXRpb24uZGV2aWNlc1tpXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcHJpdmF0ZSBnZXRUYXJnZXRGaWxlbmFtZShjb25maWc6IFNjcmVlbnNob3QpOiBzdHJpbmcge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29uZmlndXJhdGlvbi5vdXREaXIgKyBcIi9cIiArIGNvbmZpZy5pZCArIFwiLnBuZ1wiO1xuICAgICAgICB9XG5cbiAgICAgICAgcHJpdmF0ZSB0YWtlU2NyZWVuc2hvdChjb25maWc6IFNjcmVlbnNob3QsIGNhbGxiYWNrOiAocmVzdWx0OiBib29sZWFuKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgICAgICAgICB2YXIgcGFnZSA9IHRoaXMucGFnZTtcblxuICAgICAgICAgICAgdmFyIHRpbWVvdXQgPSB3aW5kb3cuc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgcGFnZS5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhmYWxzZSk7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHt9XG4gICAgICAgICAgICB9LCB0aGlzLmRlZmF1bHRUaW1lb3V0KTtcblxuICAgICAgICAgICAgcGFnZS52aWV3cG9ydFNpemUgPSBjb25maWcuZGV2aWNlLmdldFZpZXdwb3J0U2l6ZSgpO1xuXG4gICAgICAgICAgICBwYWdlLm9wZW4oXG4gICAgICAgICAgICAgICAgY29uZmlnLnVybCxcbiAgICAgICAgICAgICAgICAocmVzdWx0OiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCA9PSBcInN1Y2Nlc3NcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gR2V0IHRoZSB0YXJnZXQgcmVjdGFuZ2xlXG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZWN0YW5nbGUgPSBjb25maWcuZ2V0VGFyZ2V0UmVjdGFuZ2xlKHBhZ2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2UuY2xpcFJlY3QgPSByZWN0YW5nbGU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChleCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSW5qZWN0IGphdmFzY3JpcHQgY29kZVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpZy5pbmplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQaGFudG9tU2hvdC5ldmFsdWF0ZUphdmFTY3JpcHQocGFnZSwgY29uZmlnLmluamVjdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGV4ZWN1dGluZyBKYXZhU2NyaXB0IGNvZGVcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVuZGVyIHRoZSBwYWdlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZS5yZW5kZXIodGhpcy5nZXRUYXJnZXRGaWxlbmFtZShjb25maWcpKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENsZWFyIHRpbWVvdXRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRmluaXNoIHNob3RcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGNvbmZpZy5kZWxheSA/IGNvbmZpZy5kZWxheSA6IDApO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHByaXZhdGUgdGFrZVNjcmVlbnNob3RzKCk6IHZvaWQge1xuXG4gICAgICAgICAgICAvLyBDdXJyZW50IHNob3QgY291bnRlciBzaW5jZSB3ZSdyZSBwcm9jZXNzaW5nIHRoZSBxdWV1ZSBhc3luY2hyb25vdXNseS5cbiAgICAgICAgICAgIHZhciBjdXJyZW50U2hvdCA9IDA7XG5cbiAgICAgICAgICAgIHZhciBwcm9jZXNzU2hvdCA9ICgpID0+IHtcblxuICAgICAgICAgICAgICAgIHZhciBjb25maWcgPSB0aGlzLmNvbmZpZ3VyYXRpb24uc2hvdHNbY3VycmVudFNob3RdO1xuXG4gICAgICAgICAgICAgICAgLy8gSW5zdGFudGlhdGUgYmFzaWMgc2NyZWVuc2hvdCBjbGFzc1xuICAgICAgICAgICAgICAgIHZhciBzY3JlZW5zaG90ID0gbmV3IFNjcmVlbnNob3QoKTtcbiAgICAgICAgICAgICAgICBzY3JlZW5zaG90LmlkID0gY29uZmlnLmlkO1xuICAgICAgICAgICAgICAgIHNjcmVlbnNob3QuaW5qZWN0ID0gY29uZmlnLmluamVjdDtcbiAgICAgICAgICAgICAgICBzY3JlZW5zaG90LnVybCA9IHRoaXMuYnVpbGRGdWxsVXJsKGNvbmZpZy51cmwpO1xuICAgICAgICAgICAgICAgIHNjcmVlbnNob3QuZGV2aWNlID0gdGhpcy5nZXREZXZpY2VCeUlkKGNvbmZpZy5kZXZpY2UpO1xuICAgICAgICAgICAgICAgIHNjcmVlbnNob3QuZGVsYXkgPSBjb25maWcuZGVsYXk7XG5cbiAgICAgICAgICAgICAgICAvLyBFbGVtZW50IG9yIHJlZ2lvbiBtb2RlXG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZy5lbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHNjcmVlbnNob3QuZWxlbWVudCA9IGNvbmZpZy5lbGVtZW50O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNjcmVlbnNob3QucmVnaW9uID0gbmV3IFJlY3RhbmdsZShzY3JlZW5zaG90LmRldmljZSwgY29uZmlnLnJlZ2lvbik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gVGFrZSB0aGUgc2NyZWVuc2hvdCBhbmQgbG9vcCB0byBuZXh0IG9uZVxuICAgICAgICAgICAgICAgIHRoaXMudGFrZVNjcmVlbnNob3QoXG4gICAgICAgICAgICAgICAgICAgIHNjcmVlbnNob3QsXG4gICAgICAgICAgICAgICAgICAgIChyZXN1bHQ6IGJvb2xlYW4pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbygoY3VycmVudFNob3QgKyAxKSArIFwiLiBcIiArIChyZXN1bHQgPyBcIlNVQ0NFU1NcIiA6IFwiRVJST1JcIikgKyBcIjogXCIgKyBzY3JlZW5zaG90LmlkICsgXCIgKFwiICsgc2NyZWVuc2hvdC51cmwgKyBcIilcIilcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRTaG90ID09IHRoaXMuY29uZmlndXJhdGlvbi5zaG90cy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maW5pc2hlZENhbGxiYWNrKDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U2hvdCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NTaG90KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy8gU3RhcnQgcHJvY2Vzc2luZ1xuICAgICAgICAgICAgcHJvY2Vzc1Nob3QoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHByaXZhdGUgcmVhZENvbmZpZ0ZpbGUocGF0aDogc3RyaW5nKSB7XG4gICAgICAgICAgICAvLyBSZWFkIGNvbmZpZ1xuICAgICAgICAgICAgY29uc29sZS5pbmZvKFwiUmVhZGluZyBjb25maWcgZnJvbSBcIiArIHBhdGgpO1xuICAgICAgICAgICAgdmFyIGRhdGEgPSB0aGlzLmZpbGVzeXN0ZW0ucmVhZChwYXRoKTtcbiAgICAgICAgICAgIHRoaXMuY29uZmlndXJhdGlvbiA9IEpTT04ucGFyc2UoZGF0YSk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmNvbmZpZ3VyYXRpb24udGltZW91dCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGVmYXVsdFRpbWVvdXQgPSB0aGlzLmNvbmZpZ3VyYXRpb24udGltZW91dCAqIDEwMDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG4iLCIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vYWxsLmQudHNcIiAvPlxuXG5tb2R1bGUgUGhhbnRvbVNob3Qge1xuICAgIGV4cG9ydCBjbGFzcyBSZWN0YW5nbGUgaW1wbGVtZW50cyBJUmVnaW9uLCBDbGlwUmVjdCB7XG4gICAgICAgIHRvcDogbnVtYmVyO1xuICAgICAgICBsZWZ0OiBudW1iZXI7XG4gICAgICAgIHdpZHRoOiBudW1iZXI7XG4gICAgICAgIGhlaWdodDogbnVtYmVyO1xuXG4gICAgICAgIGNvbnN0cnVjdG9yKGRldmljZTogRGV2aWNlLCBjb25maWc/OiBJUmVnaW9uKSB7XG4gICAgICAgICAgICB0aGlzLnRvcCA9IChjb25maWcgJiYgY29uZmlnLnRvcCA/IGNvbmZpZy50b3AgOiAwKTtcbiAgICAgICAgICAgIHRoaXMubGVmdCA9IChjb25maWcgJiYgY29uZmlnLmxlZnQgPyBjb25maWcubGVmdCA6IDApO1xuICAgICAgICAgICAgdGhpcy53aWR0aCA9IChjb25maWcgJiYgY29uZmlnLndpZHRoID8gY29uZmlnLndpZHRoIDogZGV2aWNlLndpZHRoKTtcbiAgICAgICAgICAgIHRoaXMuaGVpZ2h0ID0gKGNvbmZpZyAmJiBjb25maWcuaGVpZ2h0ID8gY29uZmlnLmhlaWdodCA6IGRldmljZS5oZWlnaHQpO1xuICAgICAgICB9XG4gICAgfVxufVxuIiwiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uL2FsbC5kLnRzXCIgLz5cblxubW9kdWxlIFBoYW50b21TaG90IHtcbiAgICBleHBvcnQgY2xhc3MgU2NyZWVuc2hvdCB7XG4gICAgICAgIGlkOiBzdHJpbmc7XG4gICAgICAgIGRlbGF5OiBudW1iZXI7XG4gICAgICAgIGRldmljZTogRGV2aWNlO1xuICAgICAgICB1cmw6IHN0cmluZztcbiAgICAgICAgaW5qZWN0OiBzdHJpbmc7XG4gICAgICAgIHJlZ2lvbjogUmVjdGFuZ2xlO1xuICAgICAgICBlbGVtZW50OiBzdHJpbmc7XG5cbiAgICAgICAgZ2V0VGFyZ2V0UmVjdGFuZ2xlKHBhZ2U6IFdlYlBhZ2UpOiBSZWN0YW5nbGUge1xuICAgICAgICAgICAgaWYgKHRoaXMucmVnaW9uKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVnaW9uO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBJbmplY3QgdGFyZ2V0IGVsZW1lbnQgc2VsZWN0b3IgdmlhIGV2YWx1YXRlSmF2YXNjcmlwdCgpIHNpbmNlIGV2YWx1YXRlKCkgaXMgZXhlY3V0ZWQgd2l0aGluXG4gICAgICAgICAgICAgICAgLy8gdGhlIHBhZ2UgYW5kIGNhbm5vdCBhY2Nlc3MgdmFyaWFibGVzIGluIHRoZSBjdXJyZW50IHNjb3BlLlxuICAgICAgICAgICAgICAgIFBoYW50b21TaG90LmV2YWx1YXRlSmF2YVNjcmlwdChwYWdlLCBcIndpbmRvdy5waGFudG9tU2hvdFRhcmdldEVsZW1lbnQgPSBcIiArIEpTT04uc3RyaW5naWZ5KHRoaXMuZWxlbWVudCkgKyBcIjtcIik7XG5cbiAgICAgICAgICAgICAgICAvLyBHZXQgdGFyZ2V0IHJlY3RhbmdsZVxuICAgICAgICAgICAgICAgIHZhciByZWN0YW5nbGUgPSBwYWdlLmV2YWx1YXRlKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoKDxhbnk+d2luZG93KS5waGFudG9tU2hvdFRhcmdldEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudCA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZWN0YW5nbGUgPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IHJlY3RhbmdsZS50b3AsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogcmVjdGFuZ2xlLmxlZnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHJlY3RhbmdsZS5yaWdodCAtIHJlY3RhbmdsZS5sZWZ0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogcmVjdGFuZ2xlLmJvdHRvbSAtIHJlY3RhbmdsZS50b3BcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGlmIChyZWN0YW5nbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlY3RhbmdsZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBcIlRhcmdldCBlbGVtZW50IChcIiArIHRoaXMuZWxlbWVudCArIFwiKSBub3QgZm91bmQuXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufSIsIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJhbGwuZC50c1wiIC8+XG5cbnZhciBzeXN0ZW0gPSByZXF1aXJlKFwic3lzdGVtXCIpO1xuXG52YXIgcGhhbnRvbVNob3QgPSBuZXcgUGhhbnRvbVNob3QuUGhhbnRvbVNob3Qoc3lzdGVtLmFyZ3NbMV0pO1xucGhhbnRvbVNob3QucnVuKChyZXN1bHQpID0+IHsgcGhhbnRvbS5leGl0KHJlc3VsdCk7IH0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9